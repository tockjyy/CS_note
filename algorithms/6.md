# DH算法

* SSH通信所用的密钥同步算法，我们要是用xshell密码模式远程连接服务器用的就是这个算法交换密钥
* 这是密钥交换协议,可以通过这个算法在不安全的网络上,安全的协定一个对称加密的密钥
* 

### 0.基础算法:快速算幂
* DH算法和RSA算法都会用到相似的运算：a^b%c 。因为b是一个大整数，因此对于他的幂运算我们将b进行二分，然后对a以及a计算后的结果进行计算，这样能省下大量不必要的运算。几个例子：
``` 
3^8 = 3*3*3*3*3*3*3*3要进行7次运算
而这样化解(3^4)*(3^4）=（3^4）^2=((3^2)*(3^2))^2=((3^2)^2)^2只需要进行3次运算
第一种方式的时间复杂度是O(n)
第二种二分幂的方法时间复杂度是O(logn)
```
* 以上自网络摘抄,总之还是用了类似二分的分治方式实现的快速算幂

### 1.初始化
* 有服务器S和客户端C
* C向S请求初始信息
* S发送两个值G,P(P是很大的素数)给C(G和P两个变量都是可以被截获的)

### 2.开始计算
* 2.1 C随机生成一个数字 x(0 < x < P),进行下列运算,e = (G^x) % P,发送e给S (e可以截取)
* 2.2 S也随机生成一个数字 y(0 < y < P),进行下列运算,f = (G^y) % P,发送f给C (f可以截取)
* 2.3 C在获取f的值后计算出 Kc = (f^x) % P
* 2.4 S在获取e的值后计算出 Ks = (e^y) % P
* 2.5 绝对满足条件K == Kc == Ks, 从此K就是对称加密的密钥

### 3.例子
* S发送两个值G = 2,P = 15(很大的素数)给C(两个变量都是可以被截获的)
* 2.1 C随机生成一个数字 x = 7(0 < x < P),进行下列运算,e = (2^7) % 15 = 8,发送e=8 给S (e可以截取)
* 2.2 S也随机生成一个数字 y = 5(0 < y < P),进行下列运算,f = (2^5) % 15 = 2,发送f = 2给C (f可以截取)
* 2.3 C在获取f的值后计算出 Kc = (2^7) % 15 = 8
* 2.4 S在获取e的值后计算出 Ks = (8^5) % 15 = 8
* 2.5 绝对满足条件K == Kc == Ks = 8, 从此K就是对称加密的密钥

### 4.如果有人要窃取
* 如果一个黑客,全程都在窃取网络报文,他能得到的变量有:
* G = 2 P = 15 e = 8 f = 2
* x和y只存在内存中,并没有在网络上传播
* 要想知道K的值,只需要知道x和y其中一个就行了,但是黑客哪一个都不知道

* 破解方法1:暴力计算: 已知公式 (G ^ x) % P = e和(G ^ y) % P = f
* 所以暴力计算(G ^ n) % p = m,给n遍历赋值(0 < n < P),只要算出m的值为e或者f中的其中一个,就能知道对应的x或y,从而推测出K的值
* 而且这个算式有规律的
``` cpp
(2^n) % 15：
(2^1) % 15 = 2
(2^2) % 15 = 4
(2^3) % 15 = 8
(2^4) % 15 = 1

(2^5) % 15 = 2
(2^6) % 15 = 4
(2^7) % 15 = 8
(2^7) % 15 = 1
```
* 是循环关系,所以要是P的值是15,只要算4次就能破解K的值
* 所以要求P是很大的素数,这样的话,计算的话破解成本将会非常的高,所以灰常的安全
* 而且一般都会要求x和y的值足够大,否则容易在暴力破解的前几次就被破解

* 破解方法2:公式计算
* e = (G^x) % P 正常计算x的值,对数加取模在计算机里怎么算是个难点,数学上没有证明这个算法是否存在